<html>
<head>
<title>homer_server.md</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.ln { color: #606366; font-weight: normal; font-style: normal; }
.s0 { color: rgb(169,183,198); }
.s1 { color: rgb(204,120,50); font-weight: bold; }
.s2 { color: rgb(169,183,198); }
.s3 { color: rgb(128,128,128); }
</style>
</head>
<BODY BGCOLOR="#2b2b2b">
<TABLE CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<TR><TD><CENTER>
<FONT FACE="Arial, Helvetica" COLOR="#000000">
homer_server.md</FONT>
</center></TD></TR></TABLE>
<pre>
<span class="s0"> 
</span><span class="s1">## </span><span class="s2">Tyrion </span><span class="s0">&lt;</span><span class="s2">-</span><span class="s0">&gt; </span><span class="s2">Homer-Server </span><span class="s1">##</span><span class="s0"> 
 
</span><span class="s2">Channel Code</span><span class="s0">:: **</span><span class="s2">homer-server</span><span class="s0">** 
 
**</span><span class="s2">List of Json Objects for Comunication between Tyrion and Homer Instance</span><span class="s0">** 
 
</span><span class="s2">Any incoming or outgoing message to Tyrion and from Tyrion contains</span><span class="s0"> 
 
</span><span class="s3">        {</span><span class="s0"> 
</span><span class="s3">            &quot;message_type&quot;    :  &quot;nazev_zpravy&quot;              </span><span class="s0"> 
</span><span class="s3">            &quot;message_id&quot;      :  &quot;some_uuid_string&quot;</span><span class="s0"> 
</span><span class="s3">            &quot;message_channel&quot; :  &quot;channel_name&quot;  </span><span class="s0"> 
</span><span class="s3">        }</span><span class="s0"> 
         
</span><span class="s1"> - </span><span class="s2">yoda_unauthorized_logging </span><span class="s0"> 
</span><span class="s1"> - </span><span class="s2">checkUserPermission</span><span class="s0"> 
</span><span class="s1"> - </span><span class="s2">checkPersonToken</span><span class="s0"> 
</span><span class="s1"> - </span><span class="s2">removePersonLoginToken</span><span class="s0"> 
  
  
</span><span class="s1">### </span><span class="s2">Tyrion OutComing </span><span class="s1">###  </span><span class="s0"> 
 </span><span class="s2">Message for Tyrion for Homer</span><span class="s0"> 
  
 </span><span class="s1">#### </span><span class="s0">[</span><span class="s2">0-A</span><span class="s0">] </span><span class="s2">Server is not Verify </span><span class="s1">####</span><span class="s0"> 
 [</span><span class="s2">A</span><span class="s0">] </span><span class="s2">Veškerou komunikaci Tyrion blokuje dokud nedojde k ověření. Tu Homer server vykonává sám a to hned </span><span class="s0"> 
     </span><span class="s2">na začátku zasláním zprávy </span><span class="s0">*</span><span class="s2">message_type</span><span class="s0">::</span><span class="s2">homer_verification_token</span><span class="s0">*</span><span class="s2">. Dokud homer tuto zprávu s validním</span><span class="s0"> 
     </span><span class="s2">klíčem nepošle, Tyrion žádnou zprávu nevputí a NEUTORIZUJE HOMER SERVER JAKO ONLINE.</span><span class="s0"> 
  
</span><span class="s3">     Response: (Blokační zpráva, když není Homer ověřen)</span><span class="s0"> 
</span><span class="s3">          {  </span><span class="s0"> 
</span><span class="s3">            &quot;message_type&quot;    :  &quot;homer_verification_first_required&quot;              </span><span class="s0"> 
</span><span class="s3">            &quot;message_id&quot;      :  &quot;some_uuid_string&quot;      &lt;---  Same as ID of incoming message</span><span class="s0"> 
</span><span class="s3">            &quot;message_channel&quot; :  &quot;homer_server&quot;  </span><span class="s0"> 
</span><span class="s3">          }</span><span class="s0"> 
           
</span><span class="s3">     Po této zprávě by Homer jako první měl zaslat Tyrionovi zprávu </span><span class="s0"> 
</span><span class="s3">     Tato procedura je žádoucí i v případe, kdy přestane platit rest-api token. </span><span class="s0"> 
           
</span><span class="s3">       Request To Tyrion From Homer:</span><span class="s0"> 
</span><span class="s3">           {  </span><span class="s0"> 
</span><span class="s3">              &quot;message_type&quot;    :  &quot;homer_verification_token&quot;              </span><span class="s0"> 
</span><span class="s3">              &quot;message_id&quot;      :  &quot;some_uuid_string&quot;       </span><span class="s0"> 
</span><span class="s3">              &quot;hash_token&quot;      :  &quot;hash_token_looong_token&quot;</span><span class="s0"> 
</span><span class="s3">              &quot;message_channel&quot; :  &quot;homer_server&quot;  </span><span class="s0"> 
</span><span class="s3">           }   </span><span class="s0"> 
            
</span><span class="s3">       Response from Tyrion if Success (Token sedí || nesedí):</span><span class="s0"> 
</span><span class="s3">         {</span><span class="s0"> 
</span><span class="s3">               &quot;message_type&quot;   :   &quot;homer_verification_result&quot;    </span><span class="s0"> 
</span><span class="s3">               &quot;status&quot;         :   &quot;success | error&quot;   </span><span class="s0"> 
</span><span class="s3">               &quot;error_code&quot;     :   301                &lt;--- Opravit  </span><span class="s0"> 
</span><span class="s3">               &quot;message_id&quot;     :   &quot;same_uuid_string&quot; &lt;---  STEJNÉ UUID JAKO PŘIŠEL HASH_TOKEN             </span><span class="s0"> 
</span><span class="s3">               &quot;token&quot;          :   &quot;rest_api_token&quot;   &lt;--- Only if status is success </span><span class="s0"> 
</span><span class="s3">         }           </span><span class="s0"> 
      
 </span><span class="s1">#### </span><span class="s0">[</span><span class="s2">1</span><span class="s0">] </span><span class="s2">Get server configuration </span><span class="s1">#### </span><span class="s0"> 
  
</span><span class="s3">     Request: </span><span class="s0"> 
</span><span class="s3">            {</span><span class="s0"> 
</span><span class="s3">               &quot;message_type&quot;    :   &quot;homer_get_verification_token&quot;              </span><span class="s0"> 
</span><span class="s3">               &quot;message_id&quot;      :   &quot;some_uuid_string&quot;</span><span class="s0"> 
</span><span class="s3">               &quot;message_channel&quot; :   &quot;homer_server&quot;  </span><span class="s0"> 
                
</span><span class="s3">             }   </span><span class="s0"> 
             
</span><span class="s3">     Response:</span><span class="s0"> 
</span><span class="s3">              {</span><span class="s0"> 
</span><span class="s3">                &quot;status&quot;         :   &quot;success | error&quot;</span><span class="s0"> 
</span><span class="s3">                &quot;message_id&quot;      :   &quot;same_uuid_string&quot; </span><span class="s0"> 
                  
</span><span class="s3">                &quot;server_name&quot;    :   &quot;homer&quot;   &lt;--- Only if status is success </span><span class="s0"> 
</span><span class="s3">                &quot;mqtt_port&quot;      :   &quot;homer&quot;   &lt;--- Only if status is success  </span><span class="s0"> 
</span><span class="s3">                &quot;mqtt_user&quot;      :   &quot;homer&quot;   &lt;--- Only if status is success </span><span class="s0"> 
</span><span class="s3">                &quot;mqtt_password&quot;  :   &quot;homer&quot;   &lt;--- Only if status is success </span><span class="s0"> 
</span><span class="s3">                &quot;error_code&quot;     :   414 (Int) &lt;--- Only if status is error </span><span class="s0"> 
</span><span class="s3">              }         </span><span class="s0"> 
                
               
 </span><span class="s1">#### </span><span class="s0">[</span><span class="s2">2</span><span class="s0">] </span><span class="s2">SET server configuration </span><span class="s1">#### </span><span class="s0"> 
  
</span><span class="s3">      // Zatím nepodporováno TODO </span><span class="s0"> 
  
 </span><span class="s1">#### </span><span class="s0">[</span><span class="s2">3</span><span class="s0">] </span><span class="s2">Add Instance </span><span class="s1">####</span><span class="s0"> 
      
</span><span class="s3">     Request: </span><span class="s0"> 
</span><span class="s3">         {</span><span class="s0"> 
</span><span class="s3">            &quot;message_type&quot;    :   &quot;instance_create&quot;              </span><span class="s0"> 
</span><span class="s3">            &quot;message_id&quot;      :   &quot;some_uuid_string&quot;</span><span class="s0"> 
</span><span class="s3">            &quot;message_channel&quot; :   &quot;homer_server&quot;  </span><span class="s0"> 
</span><span class="s3">            &quot;instance_id:     :   &quot;id_1&quot; </span><span class="s0"> 
</span><span class="s3">         }</span><span class="s0"> 
          
</span><span class="s3">      Response: (Odpovídá se na příkaz, nikoliv na celou exekutivitu vkonání přidání instance) </span><span class="s0"> 
</span><span class="s3">      // Error - Nelze přidat stejnou instanci </span><span class="s0"> 
</span><span class="s3">         {</span><span class="s0"> 
</span><span class="s3">           &quot;status&quot;         :   &quot;success | error&quot;</span><span class="s0"> 
</span><span class="s3">           &quot;message_id&quot;      :   &quot;same_uuid_string&quot;  </span><span class="s0"> 
</span><span class="s3">           &quot;error_code&quot;     :   414 (Int)  (Only if status is error) </span><span class="s0"> 
</span><span class="s3">         }</span><span class="s0"> 
  
  
 </span><span class="s1">#### </span><span class="s0">[</span><span class="s2">4</span><span class="s0">] </span><span class="s2">Remove Instance </span><span class="s1">#### </span><span class="s0"> 
 </span><span class="s2">Odstraním-li Instanci - tak veškerý hardware se z instance vyřadí, ale zůstane připojený,</span><span class="s0"> 
 </span><span class="s2">nadále hardware nevrací id instance že v ní j. </span><span class="s0"> 
  
</span><span class="s3">     Request: </span><span class="s0"> 
</span><span class="s3">             {</span><span class="s0"> 
</span><span class="s3">                &quot;message_type&quot;    :   &quot;instance_destroy&quot;              </span><span class="s0"> 
</span><span class="s3">                &quot;message_id&quot;      :   &quot;some_uuid_string&quot;</span><span class="s0"> 
</span><span class="s3">                &quot;message_channel&quot; :   &quot;homer_server&quot;  </span><span class="s0"> 
</span><span class="s3">                &quot;instance_id:    :   &quot;id_1&quot;</span><span class="s0"> 
</span><span class="s3">             }</span><span class="s0"> 
              
</span><span class="s3">     Response:</span><span class="s0"> 
</span><span class="s3">     // Error - Lze Smazat neexistující instanci </span><span class="s0"> 
</span><span class="s3">             {</span><span class="s0"> 
</span><span class="s3">               &quot;status&quot;         :   &quot;success | error&quot;</span><span class="s0"> 
</span><span class="s3">               &quot;message_id&quot;      :   &quot;same_uuid_string&quot;  </span><span class="s0"> 
</span><span class="s3">               &quot;error_code&quot;     :    414 (Int)  (Only if status is error) </span><span class="s0"> 
</span><span class="s3">             }      </span><span class="s0"> 
   
   
  </span><span class="s1">#### </span><span class="s0">[</span><span class="s2">5</span><span class="s0">] </span><span class="s2">Get Instance Numbers </span><span class="s1">####  </span><span class="s0"> 
   
</span><span class="s3">    Request: </span><span class="s0"> 
</span><span class="s3">             {</span><span class="s0"> 
</span><span class="s3">                &quot;message_type&quot;    :   &quot;homer_instance_number&quot;              </span><span class="s0"> 
</span><span class="s3">                &quot;message_id&quot;      :   &quot;some_uuid_string&quot;</span><span class="s0"> 
</span><span class="s3">                &quot;message_channel&quot; :   &quot;homer_server&quot;  </span><span class="s0"> 
</span><span class="s3">             }  </span><span class="s0"> 
   
</span><span class="s3">    Result: </span><span class="s0"> 
</span><span class="s3">            {</span><span class="s0"> 
</span><span class="s3">                &quot;status&quot;         :   &quot;success | error&quot;</span><span class="s0"> 
</span><span class="s3">                &quot;message_id&quot;      :   &quot;same_uuid_string&quot;  </span><span class="s0"> 
</span><span class="s3">                &quot;value&quot;          :   123 (Int)  (Only if status is success)    </span><span class="s0"> 
</span><span class="s3">                &quot;error_code&quot;     :   414 (Int)  (Only if status is error) </span><span class="s0"> 
</span><span class="s3">            }</span><span class="s0"> 
             
               
  </span><span class="s1">#### </span><span class="s0">[</span><span class="s2">6</span><span class="s0">] </span><span class="s2">Get Instance List </span><span class="s1">####  </span><span class="s0"> 
   
</span><span class="s3">      Request: </span><span class="s0"> 
</span><span class="s3">               {</span><span class="s0"> 
</span><span class="s3">                    &quot;message_type&quot;    :   &quot;homer_instance_list&quot;              </span><span class="s0"> 
</span><span class="s3">                    &quot;message_id&quot;      :   &quot;some_uuid_string&quot;</span><span class="s0"> 
</span><span class="s3">                    &quot;message_channel&quot; :   &quot;homer_server&quot;  </span><span class="s0"> 
</span><span class="s3">               }  </span><span class="s0"> 
   
</span><span class="s3">      Result: </span><span class="s0"> 
</span><span class="s3">               {</span><span class="s0"> 
</span><span class="s3">                    &quot;status&quot;          :   &quot;success | error&quot;</span><span class="s0"> 
</span><span class="s3">                    &quot;message_id&quot;      :   &quot;same_uuid_string&quot;  </span><span class="s0"> 
</span><span class="s3">                    &quot;instnace_ids&quot;    :   [&quot;id_1&quot;, &quot;id_2&quot;] </span><span class="s0"> 
</span><span class="s3">                    &quot;error_code&quot;      :   414 (Int)  (Only if status is error) </span><span class="s0"> 
</span><span class="s3">               }</span><span class="s0"> 
             
  </span><span class="s1">#### </span><span class="s0">[</span><span class="s2">7</span><span class="s0">] </span><span class="s2">Get Total Online Hardware </span><span class="s1">####  </span><span class="s0"> 
     
</span><span class="s3">      Request: </span><span class="s0"> 
</span><span class="s3">               {</span><span class="s0"> 
</span><span class="s3">                    &quot;message_type&quot;     :   &quot;homer_hardware_number&quot;              </span><span class="s0"> 
</span><span class="s3">                    &quot;message_id&quot;       :   &quot;some_uuid_string&quot;</span><span class="s0"> 
</span><span class="s3">                    &quot;message_channel&quot;  :   &quot;homer_server&quot;  </span><span class="s0"> 
</span><span class="s3">               }  </span><span class="s0"> 
     
</span><span class="s3">      Result: </span><span class="s0"> 
</span><span class="s3">               {</span><span class="s0"> 
</span><span class="s3">                    &quot;status&quot;           :   &quot;success | error&quot;</span><span class="s0"> 
</span><span class="s3">                    &quot;message_id&quot;       :   &quot;same_uuid_string&quot;  </span><span class="s0"> 
</span><span class="s3">                    &quot;value&quot;            :   123 (Int)  (Only if status is success)    </span><span class="s0"> 
</span><span class="s3">                    &quot;error_code&quot;       :   414 (Int)  (Only if status is error) </span><span class="s0"> 
</span><span class="s3">               }          </span><span class="s0"> 
 
   </span><span class="s1">#### </span><span class="s0">[</span><span class="s2">8</span><span class="s0">] </span><span class="s2">Get Hardware List Ids </span><span class="s1">####  </span><span class="s0"> 
     
</span><span class="s3">      Request: </span><span class="s0"> 
</span><span class="s3">               {</span><span class="s0"> 
</span><span class="s3">                  &quot;message_type&quot;    :   &quot;homer_hardware_list&quot;              </span><span class="s0"> 
</span><span class="s3">                  &quot;message_id&quot;      :   &quot;some_uuid_string&quot;</span><span class="s0"> 
</span><span class="s3">                  &quot;message_channel&quot; :   &quot;homer_server&quot;  </span><span class="s0"> 
</span><span class="s3">               }  </span><span class="s0"> 
     
</span><span class="s3">      Result: </span><span class="s0"> 
</span><span class="s3">               { </span><span class="s0"> 
</span><span class="s3">                  &quot;status&quot;         :   &quot;success | error&quot;</span><span class="s0"> 
</span><span class="s3">                  &quot;message_id&quot;     :   &quot;same_uuid_string&quot;  </span><span class="s0"> 
</span><span class="s3">                  &quot;device_ids&quot;     :   [&quot;id_1&quot;, &quot;id_2&quot;] </span><span class="s0"> 
</span><span class="s3">                  &quot;error_code&quot;     :   414 (Int)  (Only if status is error) </span><span class="s0"> 
</span><span class="s3">               }          </span><span class="s0"> 
         
   </span><span class="s1">#### </span><span class="s0">[</span><span class="s2">9</span><span class="s0">] </span><span class="s2">Ping Homer Server </span><span class="s1">####  </span><span class="s0"> 
     
</span><span class="s3">         Request: </span><span class="s0"> 
</span><span class="s3">                  {</span><span class="s0"> 
</span><span class="s3">                    &quot;message_type&quot;    :   &quot;homer_ping&quot;              </span><span class="s0"> 
</span><span class="s3">                    &quot;message_id&quot;      :   &quot;some_uuid_string&quot;</span><span class="s0"> 
</span><span class="s3">                    &quot;message_channel&quot; :   &quot;homer_server&quot;  </span><span class="s0"> 
</span><span class="s3">                  }  </span><span class="s0"> 
           
</span><span class="s3">         Result: </span><span class="s0"> 
</span><span class="s3">                  {</span><span class="s0"> 
</span><span class="s3">                     &quot;status&quot;         :   &quot;success | error&quot;</span><span class="s0"> 
</span><span class="s3">                     &quot;message_id&quot;     :   &quot;same_uuid_string&quot;  </span><span class="s0"> 
</span><span class="s3">                     &quot;response_time&quot;  :   123 (ms)  (Only if status is success)   </span><span class="s0"> 
</span><span class="s3">                     &quot;error_code&quot;     :   414 (Int) (Only if status is error) </span><span class="s0"> 
</span><span class="s3">                  }  </span><span class="s0"> 
                   
                   
                   
</span><span class="s1">### </span><span class="s2">Tyrion Incoming </span><span class="s1">###</span><span class="s0"> 
 </span><span class="s2">Message from Homer to Tyrion </span><span class="s0"> 
      
      
     </span></pre>
</body>
</html>