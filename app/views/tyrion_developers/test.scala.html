
@(fileNames: List[String], log: String)


<section class="content-header">
    <h1> Testing application </h1>
    <ol class="breadcrumb">
        <li><a href="@routes.Controller_Dashboard.index()"><i class="fa fa-globe"></i> Dashboard </a></li>
        <li class="active"><i class="fa fa-bug"></i> For Tyrion Developers </li>
        <li class="active"><i class="fa fa-gears"></i> Tests </li>
    </ol>
</section>

<section class="content">
    <div class="row">
        <div class="col-md-12">
            <div class="box">
                <div class="box-header with-border">
                    <h3 class="box-title">Test results <small>test.log</small></h3>
                    <div class="pull-right">
                        <select class="select2 margin-r-5" title="Available tests" id="selected_test">
                            <option value="test">Complete test</option>
                            @for(test_name <- fileNames){
                                @if(!test_name.equals("TestHelper")){
                                    <option value="testOnly_@test_name">@test_name</option>
                                }
                            }
                        </select>
                        <div class="btn-group">
                            <button class="btn btn-xs btn-danger " type="button" onclick="clear_log()">Clear log</button>
                            <button class="btn btn-xs btn-info" type="button" onclick="refresh_log()">Refresh log</button>
                            <button class="btn btn-xs btn-success" type="button" onclick="run_test()">Run Test</button>
                        </div>
                    </div>
                </div>
                <div class="box-body">
                    <textarea class="form-control form-group" id="log_textarea" rows="25" placeholder="Reported succeeded or failed tests..." readonly>@log</textarea>
                </div>
                <div class="box-footer">
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    function run_test(){
        $("#loading_overlay").css("visibility","visible");
        var cmd = $("#selected_test").val();
        $.ajax({
            url: '/admin/test/run/' + cmd,
            type: 'GET',
            headers: {
                "X-AUTH-TOKEN":getCookie("authToken")
            },
            dataType: 'json',
            success:function(json){
                $("#loading_overlay").css("visibility","hidden");
                refresh_log();
            },
            error:function(e) {
                $("#loading_overlay").css("visibility","hidden");
                alert(e.message);
            }
        })
    }

</script>
<script>

    function refresh_log(){
        $.ajax({
            url: '/admin/test/log',
            type: 'GET',
            contentType: 'application/json',
            headers: {
                "X-AUTH-TOKEN":getCookie("authToken")
            },
            dataType: 'json',
            success:function(json){
                $("#log_textarea").text(json.message);
            },
            error:function(e) {
                alert(e.message);
            }
        })
    }

</script>
<script>

    function clear_log(){
        $.ajax({
            url: '/admin/test/log/clear',
            type: 'GET',
            headers: {
                "X-AUTH-TOKEN":getCookie("authToken")
            },
            dataType: 'json',
            success:function(json){
                $("#log_textarea").text("");
            },
            error:function(e) {
                alert(e.responseText);
            }
        })
    }
</script>