@import models.Model_Board
@import models.Model_CompilationServer
@import models.Model_Person
@import models.Model_HomerServer
@import models.Model_Project
@import models.Model_RequestLog


<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>

<section class="content-header">
    <h1> Dashboard <small>Control panel</small> </h1>
    <ol class="breadcrumb">
        <li class="active"><i class="fa fa-globe"></i> Dashboard </li>
    </ol>
</section>

<section class="content"  style="min-height: 150px;">
<!-- ----------------------------------------------------------------------------------------------------------------------- -->
          <div class="row">

            <div class="col-lg-3 col-xs-6"><div class="small-box bg-aqua"><div class="inner">
                  <h3>@Model_Person.find.findRowCount()</h3>
                  <p>Persons registered</p>
                  </div><div class="icon"><i class="ion ion-person"></i></div> </div>
            </div>

            <div class="col-lg-3 col-xs-6"><div class="small-box bg-aqua"><div class="inner">
                  <h3>@Model_Project.find.findRowCount()</h3>
                  <p>Project created</p>
                  </div><div class="icon"><i class="ion ion-person"></i></div> </div>
            </div>

            <div class="col-lg-3 col-xs-6"><div class="small-box bg-aqua"><div class="inner">
                  <h3>@Model_Board.find.findRowCount()</h3>
                  <p>Board registered</p>
                  </div><div class="icon"><i class="ion ion-person"></i></div> </div>
            </div>
          </div><!-- /.row -->
<!-- ------------------------------------------------------------------------------------------------------------------ -->
</section><!-- /.content -->

<section class="content-header">
    <h1> Homer cloud servers <small>Control panel</small> </h1>
</section>
<section class="content" style="min-height: 150px;">
    <div class="row">

    @for( x <- Model_HomerServer.find.all()) {

        <div class="col-lg-4 col-xs-6"><div
                @if(x.server_is_online()) {
                    class="small-box bg-green-gradient"
                } else {
                    class="small-box bg-red"
                }><div class="inner">
            <h3>@x.personal_server_name</h3>
            <p></p>
            <p>
                @if(x.server_is_online()) {
                    Instances: @x.get_homer_server_number_of_instance().value
                }
                <a href=' @routes.Controller_Dashboard.show_websocket_server_detail(  x.unique_identificator )' >
                    <button class="btn btn-block btn-info btn-xs">All Instancies</button>
                </a>
            </p>
             </div><div class="icon"><i class="ion fa-cloud_blocko_server"></i></div> </div>
        </div>
    }
    </div><!-- /.row -->
</section>

<section class="content-header">
    <h1> Compilation servers <small>Control panel</small> </h1>
</section>
<section class="content" style="min-height: 150px;">
    <div class="row">

    @for( x <- Model_CompilationServer.find.all()) {
        <div class="col-lg-4 col-xs-6"><div
            @if(x.server_is_online()) {
                class="small-box bg-green-gradient"
            } else {
                class="small-box bg-red"
                }><div class="inner">
            <h3>@x.personal_server_name</h3>
            <p></p>
        </div><div class="icon"><i class="ion fa-cloud_blocko_server"></i></div> </div>
        </div>
    }

    </div><!-- /.row -->
</section>

<section class="content" style="min-height: 150px;">
    <div class="row">
        <div class="col-md-12">
            <div class="box">
                <div class="box-header with-border">
                    <h3 class="box-title">Request stats</h3>
                    <div class="box-tools pull-right">
                        <button class="btn btn-box-tool" type="button" onclick="reset_request_stats()" title="Reset stats"><i class="fa fa-remove"></i></button>
                        <button class="btn btn-box-tool" type="button" onclick="get_request_stats()" title="Refresh stats"><i class="fa fa-refresh"></i></button>
                        <button class="btn btn-box-tool" type="button" data-widget="collapse"><i class="fa fa-minus"></i></button>
                    </div>
                </div>
                <div class="box-body">
                    <div class="chart" style="max-height: 300px;">
                        <canvas id="barChart" height="300px"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script type="text/javascript">

    function get_request_stats() {

        $.ajax({
            url: '/admin/request_stats',
            type: 'GET',
            headers: {
                "X-AUTH-TOKEN":getCookie("authToken")
            },
            dataType: 'json',
            success:function(json){
                chart(json);
            },
            error:function(e) {
                alert(JSON.stringify(JSON.parse(e.responseText).message));
            }
        })
    }

    function reset_request_stats() {

        $.ajax({
            url: '/admin/request_stats',
            type: 'DELETE',
            headers: {
                "X-AUTH-TOKEN":getCookie("authToken")
            },
            dataType: 'json',
            success:function(json){
                get_request_stats();
            },
            error:function(e) {
                alert(JSON.stringify(JSON.parse(e.responseText).message));
            }
        })
    }

    function chart(data) {

        var values = [];
        var labels = [];

        $.each(data, function (k, v) {
            values[k] = v.call_count;
            labels[k] = v.request;
        });

        var ctx = document.getElementById("barChart");
        var barChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    backgroundColor:'rgba(0, 171, 239, 0.6)',
                    hoverBackgroundColor:'rgba(0, 150, 219, 0.7)',
                    label: 'requests',
                    data: values
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero:true
                        }
                    }]
                },
                legend: {
                    display: false
                }
            }
        });
    }

    get_request_stats();

</script>








