
@(fileNames: List[String], log: String)


<section class="content-header">
    <h1> Testing application </h1>
    <ol class="breadcrumb">
        <li><a href="@routes.DashboardController.index()"><i class="fa fa-globe"></i> Dashboard </a></li>
        <li class="active"><i class="fa fa-gears"></i> Test </li>
    </ol>
</section>

            <!-- Main content -->
        <section class="content">
            <div class="row">
                <div class="col-md-3">
                    <div class="box">
                        <div class="box-header with-border">
                            <h3 class="box-title">Run test</h3>
                        </div>
                        <div class="box-body">
                            <form style="float: left">
                                <label>Available tests:</label>
                                <select id="selected_test">
                                    <option value="test">Complete test</option>
                                    @for(test_name <- fileNames){
                                        @if(!test_name.equals("TestHelper")){
                                            <option value="testOnly_@test_name">@test_name</option>
                                        }
                                    }
                                </select>
                                <button style="margin-top: 10px;" class="btn btn-block btn-success" type="button" onclick="run_test()">Run Test</button>
                            </form>
                        </div>
                        <div class="box-footer">
                        </div>
                    </div>
                </div>
                <div class="col-md-9">
                    <div class="box">
                        <div class="box-header with-border">
                            <h3 class="box-title">Test results <small>test.log</small></h3>
                        </div>
                        <div class="box-body">
                            <label>test.log (if empty, test did not report any errors)</label>
                            <textarea id="log_textarea" style="width: 100%;" rows="10">@log</textarea>
                            <button style="width: 20%; margin-top: 10px; margin-left: 10px;" class="btn btn-block btn-danger pull-right" type="button" onclick="clear_log()">Clear log</button>
                            <button style="width: 20%; margin-top: 10px;" class="btn btn-block btn-info pull-right" type="button" onclick="refresh_log()">Refresh log</button>
                        </div>
                        <div class="box-footer">
                        </div>
                    </div>
                </div>
            </div>
        </section><!-- /.content -->


<script>
    function run_test(){
        $("#loading_overlay").css("visibility","visible");
        var cmd = $("#selected_test").val();
        $.ajax({
            url: '/admin/test/run/' + cmd,
            type: 'GET',
            headers: {
                "X-AUTH-TOKEN":getCookie("authToken")
            },
            dataType: 'json',
            success:function(json){
                $("#loading_overlay").css("visibility","hidden");
                refresh_log();
            },
            error:function(e) {
                $("#loading_overlay").css("visibility","hidden");
                alert(e.message);
            }
        })
    }

</script>
<script>

    function refresh_log(){
        $.ajax({
            url: '/admin/test/log',
            type: 'GET',
            contentType: 'application/json',
            headers: {
                "X-AUTH-TOKEN":getCookie("authToken")
            },
            dataType: 'json',
            success:function(json){
                $("#log_textarea").text(json.message);
            },
            error:function(e) {
                alert(e.message);
            }
        })
    }

</script>
<script>

    function clear_log(){
        $.ajax({
            url: '/admin/test/log/clear',
            type: 'GET',
            headers: {
                "X-AUTH-TOKEN":getCookie("authToken")
            },
            dataType: 'json',
            success:function(json){
                $("#log_textarea").text("");
            },
            error:function(e) {
                alert(e.responseText);
            }
        })
    }
</script>